<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="George Metaxas ">
<meta name="description" content="Sometimes you may be required to implement code that executes periodic actions. In Java, you can implement such a feature using a Timer. Kotlin also provided a wrapper for this, using the fixedRateTimer function. The above mentioned method of creating a timer is old-style, thread-based and JVM specific. Coroutines offer a better solution for solving this problem, in a more lightweight, efficient and cross-platform manner. One such more-kotlin styled approach, is provided by the ticker, which is part of the Channels API." />
<meta name="keywords" content="homepage, blog, android, development, kotlin, java, testing, ci, mobile, unit test, coroutines, kotest, junit5, timer" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="" />
<link rel="canonical" href="https://gmetal.dev/posts/unit-testing-withtimeout-with-kotest/" />


    <title>
        
            Unit Testing WithTimeout in Coroutines With Kotest :: gmetal&#39;s dev blog  â€” A spiral tower
        
    </title>



<link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css" rel="stylesheet"
    type="text/css">






<link rel="stylesheet" href="/main.c46cbca46fa76c0fcd3da8313ecf4adee5fb3ffb0288c0902d7e90aead220d79.css">
<link rel="stylesheet" href="/admonition.css">
<link rel="stylesheet" href="https://gmetal-blog.web.app/other.css">






<meta itemprop="name" content="Unit Testing WithTimeout in Coroutines With Kotest">
<meta itemprop="description" content="Sometimes you may be required to implement code that executes periodic actions. In Java, you can implement such a feature using a Timer. Kotlin also provided a wrapper for this, using the fixedRateTimer function. The above mentioned method of creating a timer is old-style, thread-based and JVM specific. Coroutines offer a better solution for solving this problem, in a more lightweight, efficient and cross-platform manner. One such more-kotlin styled approach, is provided by the ticker, which is part of the Channels API."><meta itemprop="datePublished" content="2021-11-03T08:01:49&#43;00:00" />
<meta itemprop="dateModified" content="2021-11-03T08:01:49&#43;00:00" />
<meta itemprop="wordCount" content="2558"><meta itemprop="image" content="https://gmetal.dev/"/>
<meta itemprop="keywords" content="unit test,coroutines,kotest,junit5,timer," />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://gmetal.dev/"/>

<meta name="twitter:title" content="Unit Testing WithTimeout in Coroutines With Kotest"/>
<meta name="twitter:description" content="Sometimes you may be required to implement code that executes periodic actions. In Java, you can implement such a feature using a Timer. Kotlin also provided a wrapper for this, using the fixedRateTimer function. The above mentioned method of creating a timer is old-style, thread-based and JVM specific. Coroutines offer a better solution for solving this problem, in a more lightweight, efficient and cross-platform manner. One such more-kotlin styled approach, is provided by the ticker, which is part of the Channels API."/>




    <meta property="og:title" content="Unit Testing WithTimeout in Coroutines With Kotest" />
<meta property="og:description" content="Sometimes you may be required to implement code that executes periodic actions. In Java, you can implement such a feature using a Timer. Kotlin also provided a wrapper for this, using the fixedRateTimer function. The above mentioned method of creating a timer is old-style, thread-based and JVM specific. Coroutines offer a better solution for solving this problem, in a more lightweight, efficient and cross-platform manner. One such more-kotlin styled approach, is provided by the ticker, which is part of the Channels API." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://gmetal.dev/posts/unit-testing-withtimeout-with-kotest/" /><meta property="og:image" content="https://gmetal.dev/"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-11-03T08:01:49&#43;00:00" />
<meta property="article:modified_time" content="2021-11-03T08:01:49&#43;00:00" /><meta property="og:site_name" content="gmetal&#39;s dev blog" />







    <meta property="article:published_time" content="2021-11-03 08:01:49 &#43;0000 UTC" />








    </head>

    
        <body>
    
    
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">></span>
            <span class="logo__text">A spiral tower</span>
            <span class="logo__cursor" style=
                  "
                   
                   ">
            </span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="/about">About</a></li><li><a href="/posts">Blog</a></li><li><a href="/projects">Projects</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            
                <span class="theme-toggle not-selectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
   <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
   3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
   13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
 </svg></span>
        </span>
    </span>
</header>


            <div class="content">
                
  <main class="post">

    <div class="post-info">
      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock">
          <circle cx="12" cy="12" r="10"></circle>
          <polyline points="12 6 12 12 16 14"></polyline>
        </svg>
        13 minutes

        
      </p>
    </div>

    <article>
      <h1 class="post-title">
        <a href="https://gmetal.dev/posts/unit-testing-withtimeout-with-kotest/">Unit Testing WithTimeout in Coroutines With Kotest</a>
      </h1>

      

      

      

      <div class="post-content">
        <p>Sometimes you may be required to implement code that executes periodic actions. In Java, you can implement such a feature using a <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/Timer.html">Timer</a>. Kotlin also provided a wrapper for this, using the <a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.concurrent/fixed-rate-timer.html">fixedRateTimer</a> function. The above mentioned method of creating a timer is old-style, thread-based and JVM specific. Coroutines offer a better solution for solving this problem, in a more lightweight, efficient and cross-platform manner. One such more-kotlin styled approach, is provided by the <a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.channels/ticker.html">ticker</a>, which is part of the Channels API. However, this approach is currently marked as <a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/-obsolete-coroutines-api/index.html">ObsoleteCoroutinesApi</a>, and may be subject to change.</p>
<h2 id="a-suspendable-coroutine-based-timer-implementation">A suspendable, coroutine-based Timer implementation</h2>
<p>It is not very difficult to create a custom implementation of the Timer functionality, while also leveraging the power of Kotlin coroutines. This can be based on the <a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/with-timeout.html">withTimeout</a> and the <a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/delay.html">delay</a> functions. The <code>withTimeout</code> function runs a given block until the specified timeout. If the timeout is not exceeded, then it exists normally. However, if the timeout is exceeded, it throws a <code>TimeoutCancellationException</code>. The <code>delay</code> function will suspend the current coroutine until the specified amount of time has passed.</p>
<p>Using the abovementioned suspending functions, a trivial timer implementation can be implemented:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin" data-lang="kotlin"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">CoroutineTimer</span>(
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">val</span> period: Long = <span style="color:#ae81ff">1000L</span>,
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">val</span> repeat: Boolean = <span style="color:#66d9ef">false</span>,
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">val</span> dispatcher: CoroutineDispatcher = Dispatchers.Default,
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">val</span> timerAction: () <span style="color:#f92672">-&gt;</span> Unit
) {
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">var</span> job: Job? = <span style="color:#66d9ef">null</span>

    <span style="color:#75715e">/**
</span><span style="color:#75715e">     * Starts the execution of the timer
</span><span style="color:#75715e">     */</span>
    <span style="color:#a6e22e">@Synchronized</span>
    <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">start</span>() {
        <span style="color:#66d9ef">if</span> (isRunning()) {
            <span style="color:#66d9ef">return</span>
        }

        job = CoroutineScope(dispatcher).launch {
            withTimeout(period) {
                delay(period + <span style="color:#ae81ff">1</span>)
            }
        }.also {
            <span style="color:#66d9ef">it</span>.invokeOnCompletion { exc <span style="color:#f92672">-&gt;</span>
                <span style="color:#66d9ef">when</span> (exc) {
                    <span style="color:#66d9ef">is</span> TimeoutCancellationException <span style="color:#f92672">-&gt;</span> {
                        <span style="color:#75715e">// Timeout reached, execute the action and reschedule if required
</span><span style="color:#75715e"></span>                        timerAction()
                        <span style="color:#66d9ef">if</span> (repeat) {
                            start()
                        }
                    }
                    <span style="color:#66d9ef">is</span> CancellationException <span style="color:#f92672">-&gt;</span> {
                        <span style="color:#75715e">// The stop method was called and I&#39;ve been cancelled
</span><span style="color:#75715e"></span>                        <span style="color:#75715e">// Ignore
</span><span style="color:#75715e"></span>                    }
                    <span style="color:#66d9ef">else</span> <span style="color:#f92672">-&gt;</span> {
                        <span style="color:#75715e">// Unknown exception received
</span><span style="color:#75715e"></span>                        <span style="color:#75715e">// Ignore
</span><span style="color:#75715e"></span>                    }
                }
            }
        }
    }

    <span style="color:#75715e">/**
</span><span style="color:#75715e">     * Stops the execution of the timer, if it is running
</span><span style="color:#75715e">     */</span>
    <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">stop</span>() {
        job<span style="color:#f92672">?.</span>cancel(CancellationException())
    }

    <span style="color:#75715e">/**
</span><span style="color:#75715e">     * Returns whether the timer is currently running or not
</span><span style="color:#75715e">     */</span>
    <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">isRunning</span>(): Boolean = job<span style="color:#f92672">?.</span>isActive <span style="color:#f92672">==</span> <span style="color:#66d9ef">true</span>
}
</code></pre></div><p>Let&rsquo;s dive into the code. The <code>CoroutineTimer</code> class, takes 4 arguments in its constructor:</p>
<ul>
<li>the period of execution in milliseconds</li>
<li>whether the timer is repeatable or once-off</li>
<li>the CoroutineDispatcher to use while waiting (is to better support tests)</li>
<li>the action to execute, as a non-suspending lambda that takes no arguments and returns no value (obviously this can be modified accordingly)</li>
</ul>
<div class="admonition note">
<p class="admonition title">Note</p>
<p>Specifying the coroutine dispatcher in the constructor of our class (with the desired default implementation) allows us to control it in our tests. It is currently considered a best practice. A good source of information about this approach can be found <a href="https://developer.android.com/kotlin/coroutines/coroutines-best-practices">here</a>.</p>
</div>

<p>The timer has two states, started and stopped. It is initiallised in the stopped state and can be controlled with the following methods:</p>
<ul>
<li>the <code>start</code> method starts the timer, when it is not running. If the timer is already running, it will not be started again.</li>
<li>the <code>stop</code> method stops the timer</li>
<li>the <code>isRunning</code> method returns whether the timer is currently running or not. When the timer is started, it is considered to be running, whereas when it is stopped, it is not considered as running. In case the timer is used in an once-off fashion, after the action has executed, the timer is considered to be stopped (i.e. not running).</li>
</ul>
<p>The core functionality has been implemented in the <code>start</code> method. Internally, it launches a new coroutine that uses the <code>withTimeout</code> function for the timer. Inside the <code>withTimeout</code>, the code uses the suspending <code>delay</code> function, to delay until the timeout is reached. When the timeout is reached, a <code>TimeoutCancellationException</code> is thrown by the <code>withTimeout</code> function. In case, the timer is cancelled, then a <code>CancellationException</code> will be thrown (by the <code>stop</code> method). The code will inspect the result of the coroutine, with the help of the <code>invokeOnCompletion</code>, and if the timeout was reached, it will execute the action and then proceed to reschedule the next execution of the code (if the timer is repeatable). To determine whether the timer is running and to support the timer cancellation, a reference to the <code>Job</code> object returned by <code>launch</code> function is maintained.</p>
<h2 id="unit-testing-the-implementation-with-junit---the-naive-way">Unit testing the implementation with JUnit - the naive way</h2>
<p>Testing multithreading code is always a challenging task. In our case, we have two main test cases:</p>
<ul>
<li>the timer action is executed after the timer has elapsed (exactly once when the <code>repeat</code> flag is not set, or multiple times when it is set)</li>
<li>the timer action is not executed when the timer is cancelled before it is elapsed</li>
</ul>
<p>The naive approach would be to:</p>
<ul>
<li>use a mock timer action for testing if it is executed or not</li>
<li>use a small timer interval and carefully timed <code>sleeps</code> for waiting until the timer elapses</li>
</ul>
<div class="admonition note">
<p class="admonition title">Note</p>
<p>A  <code>sleep</code> refers to an invocation of the <a href="https://docs.oracle.com/en/java/javase/15/docs/api/java.base/java/lang/Thread.html#sleep(long)">java.lang.Thread.sleep()</a> method, that will make the current thread temporarily pause, for the specified time interval in milliseconds. It is often a cheap, and inefficient way to wait for a bit before continuing to perform a task. It is rarely a good programming practice and is JVM specific.</p>
</div>

<p>There are significant shortcomings with blocking the test with the <code>sleeps</code> method  until the timer elapses. First of all, the sleeps must be carefully timed, or you may end up having non-deterministic test outcomes, due to the non-deterministic nature of thread scheduling. Blocking the thread that executes your test, increases your overall test execution time (and unit tests must not take too long). In more complex situations, using sleeps will become very difficult to manage.</p>
<p>If we had to write our tests using this inefficient manner, let&rsquo;s see how this could be done (using <a href="https://junit.org/junit5/docs/current/user-guide/">JUnit 5</a> and <a href="https://mockk.io">Mockk</a>). First of all, we want to test that when the <code>repeat</code> flag is false and the timer is started, the action will be executed after the timer has elapsed.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin" data-lang="kotlin">    <span style="color:#a6e22e">@Timeout</span>(<span style="color:#ae81ff">3500</span>, unit = TimeUnit.MILLISECONDS)
    <span style="color:#a6e22e">@Test</span>
    <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">without_repeat_calling_start_will_execute_the_timer_action_once</span>() {
        <span style="color:#66d9ef">val</span> testCoroutineTimer = CoroutineTimer(<span style="color:#ae81ff">2000</span>, <span style="color:#66d9ef">false</span>, timerAction = mockTimerAction)

        testCoroutineTimer.start()

        assertEquals(<span style="color:#66d9ef">true</span>, testCoroutineTimer.isRunning())
        <span style="color:#66d9ef">while</span> (testCoroutineTimer.isRunning()) {
            sleep(<span style="color:#ae81ff">1000</span>)
        }
        assertEquals(<span style="color:#66d9ef">false</span>, testCoroutineTimer.isRunning())
        verify { mockTimerAction.invoke() }
    }
</code></pre></div><p>The above test creates a new non-repeatable <code>CoroutineTimer</code>, with a time period of 2000 msec, which will execute the mockTimerAction. It proceeds to start the timer, verify that it is running, and then sleep until the timer stops running. When this happens, the test is concluded by verifying that the mock timer action was executed. Currently, the test runs successfully. But what would happen if while updating the code, a bug is introduced in the <code>isRunning</code> method and it always reports that the timer is running. In this case, the test would fall into an infinite loop. To cater for this eventuality, the JUnit5 <a href="https://junit.org/junit5/docs/current/api/org.junit.jupiter.api/org/junit/jupiter/api/Timeout.html">Timeout annotation</a> was added, which instructs the test runner to terminate the test execution after the specified time interval elapses.</p>
<p>To test that if the timer action is not executed when the timer is cancelled, we can use the following test:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin" data-lang="kotlin">    <span style="color:#a6e22e">@Timeout</span>(<span style="color:#ae81ff">3500</span>, unit = TimeUnit.MILLISECONDS)
    <span style="color:#a6e22e">@Test</span>
    <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">without_repeat_calling_stop_will_stop_the_timer_without_executing_the_timer_action</span>() {
        <span style="color:#66d9ef">val</span> testCoroutineTimer = CoroutineTimer(<span style="color:#ae81ff">2000</span>, <span style="color:#66d9ef">false</span>, timerAction = mockTimerAction)

        testCoroutineTimer.start()
        sleep(<span style="color:#ae81ff">1000</span>)
        assertEquals(<span style="color:#66d9ef">true</span>, testCoroutineTimer.isRunning())
        testCoroutineTimer.stop()

        <span style="color:#66d9ef">while</span> (testCoroutineTimer.isRunning()) {
            sleep(<span style="color:#ae81ff">1000</span>)
        }
        assertEquals(<span style="color:#66d9ef">false</span>, testCoroutineTimer.isRunning())
        verify { mockTimerAction wasNot called }
    }
</code></pre></div><p>In the above test, the timer is initialised with a large enough period, such that when the <code>stop</code> method is called, the timer will not have expired. The <code>isRunning</code> checks after the test must still be performed, because <code>stop</code> may not be instantaneous. Again, to avoid waiting forever for the timer to stop, the <code>Timeout</code> JUnit 5 annotation is used.</p>
<p>To test the multiple execution of the timer action (i.e. the repeat flag is set to true), the following test can be used:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin" data-lang="kotlin">    <span style="color:#a6e22e">@Test</span>
    <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">with_repeat_wait_to_execute_twice_and_then_stop</span>() {
        <span style="color:#66d9ef">val</span> testCoroutineTimer = CoroutineTimer(<span style="color:#ae81ff">2000</span>, <span style="color:#66d9ef">true</span>, timerAction = mockTimerAction)

        testCoroutineTimer.start()
        sleep(<span style="color:#ae81ff">2100</span>)
        assertEquals(<span style="color:#66d9ef">true</span>, testCoroutineTimer.isRunning())
        verify(atLeast = <span style="color:#ae81ff">1</span>, atMost = <span style="color:#ae81ff">1</span>) { mockTimerAction.invoke() }
        sleep(<span style="color:#ae81ff">2100</span>)
        testCoroutineTimer.stop()
        verify(atLeast = <span style="color:#ae81ff">2</span>, atMost = <span style="color:#ae81ff">2</span>) { mockTimerAction.invoke() }

        assertEquals(<span style="color:#66d9ef">false</span>, testCoroutineTimer.isRunning())
    }
</code></pre></div><p>The above test starts the timer, sleeps until the timer expires once, and then sleeps a bit more to verify that the timer expires again. Finally, it stops the timer execution and verifies that the timer has stopped.</p>
<h2 id="unit-testing-the-implementation-with-junit---the-coroutine-way">Unit testing the implementation with JUnit - the coroutine way</h2>
<p>Coroutines are a more advanced, modern and fine grained tool for achieving concurrency. As such, they include much better testing support, which can be found in the <a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-test/">kotlinx-coroutines-test artifact</a>. The main testing functionalities provided by the package are the following:</p>
<ul>
<li>The <a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-test/kotlinx.coroutines.test/-test-coroutine-dispatcher/index.html">TestCoroutineDispatcher</a> which executes tasks synchronously, but also allows the developer to <a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-test/kotlinx.coroutines.test/-delay-controller/index.html">control the dispatcher&rsquo;s internal clock</a>.</li>
<li>Controlling the Dispatchers.Main dispatcher, using the <a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-test/kotlinx.coroutines.test/set-main.html">Dispatchers.setMain</a> and <a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-test/kotlinx.coroutines.test/reset-main.html">Dispatchers.resetMain</a> functions.</li>
<li>The <a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-test/kotlinx.coroutines.test/run-blocking-test.html">runBlockingTest function</a>, which executes a test by bypassing any delays introduced by <code>async</code> and <code>launch</code> and skipping the calls to <code>delay</code>. In essence, this is similar to the <code>runBlocking</code> coroutine builder function.</li>
</ul>
<p>Armed with the abovementioned tools, we can rewrite our tests so that:</p>
<ul>
<li>they are much more manageable</li>
<li>they use the provided coroutine tools</li>
<li>they run faster
There are several general guidelines that will assist you in effectively testing coroutine code. First of all, you should always <code>inject</code> the dispatcher in use. You should also provide the desired dispatcher as a default value. Using this simple tip, allows you to override the dispatcher in your tests with the <code>TestCoroutineDispatcher</code>. Also, your test functions should always contain a single <code>runBlockingTest</code> call, with the test code inside. The <code>runBlockingTest</code> can use a predefined coroutine dispatcher, allowing you to easily control its internal clock. Finally, it is essentially a coroutine builder function allowing you to call other suspend functions immediately.</li>
</ul>
<div class="admonition important">
<p class="admonition title">Warning</p>
<p>The majority of the coroutine testing tools are currently marked as <code>@ExperimentalCoroutinesApi</code>, which means that their API is subject to change. You will have to explicitly enable them in your tests.</p>
</div>

<p>First of all, we declare an instance of the TestCoroutineDispatcher in our test class, which we recreate before each test. This Dispatcher will give us access to the coroutine&rsquo;s internal clock (e.g. move time forward!). Next, we wrap the body of the three aforementioned tests, inside a <code>runBlockingTest</code> call, such that we eliminate delays from <code>async</code> and <code>launch</code>. We also pass the reference of our TestCoroutineDispatcher to the <code>runBlockingTest</code> method, and also inject this dispatcher to our Timer class, such that they both use the same CoroutineContext (we are thus able to call the <code>advanceTimeBy</code> inside the body of our test, rather than explicitly on the test dispatcher). Finally, we replace the <code>sleep</code> related calls, with calls to <code>advanceTimeBy</code> (and remove any loops we may have been using).</p>
<p>Consequently, the first test becomes:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin" data-lang="kotlin">    <span style="color:#a6e22e">@Timeout</span>(<span style="color:#ae81ff">3500</span>, unit = TimeUnit.MILLISECONDS)
    <span style="color:#a6e22e">@Test</span>
    <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">without_repeat_calling_start_will_execute_the_timer_action_once</span>() = runBlockingTest(testCoroutineDispatcher) {
        <span style="color:#66d9ef">val</span> testCoroutineTimer = CoroutineTimer(<span style="color:#ae81ff">2000</span>, <span style="color:#66d9ef">false</span>, testCoroutineDispatcher, mockTimerAction)

        testCoroutineTimer.start()

        assertEquals(<span style="color:#66d9ef">true</span>, testCoroutineTimer.isRunning())
        advanceTimeBy(<span style="color:#ae81ff">2100</span>)

        assertEquals(<span style="color:#66d9ef">false</span>, testCoroutineTimer.isRunning())
        verify { mockTimerAction.invoke() }
    }
</code></pre></div><p>The second test becomes:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin" data-lang="kotlin">    <span style="color:#a6e22e">@Timeout</span>(<span style="color:#ae81ff">3500</span>, unit = TimeUnit.MILLISECONDS)
    <span style="color:#a6e22e">@Test</span>
    <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">without_repeat_calling_stop_will_stop_the_timer_without_executing_the_timer_action</span>() = runBlockingTest(testCoroutineDispatcher) {
        <span style="color:#66d9ef">val</span> testCoroutineTimer = CoroutineTimer(<span style="color:#ae81ff">2000</span>, <span style="color:#66d9ef">false</span>, testCoroutineDispatcher, mockTimerAction)

        testCoroutineTimer.start()
        advanceTimeBy(<span style="color:#ae81ff">1000</span>)
        assertEquals(<span style="color:#66d9ef">true</span>, testCoroutineTimer.isRunning())
        testCoroutineTimer.stop()
        advanceTimeBy(<span style="color:#ae81ff">1500</span>)

        assertEquals(<span style="color:#66d9ef">false</span>, testCoroutineTimer.isRunning())
        verify { mockTimerAction wasNot called }
    }
</code></pre></div><p>And finally, the third test becomes:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin" data-lang="kotlin">    <span style="color:#a6e22e">@Test</span>
    <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">with_repeat_wait_to_execute_twice_and_then_stop</span>() = runBlockingTest(testCoroutineDispatcher) {
        <span style="color:#66d9ef">val</span> testCoroutineTimer = CoroutineTimer(<span style="color:#ae81ff">2000</span>, <span style="color:#66d9ef">true</span>, testCoroutineDispatcher, mockTimerAction)

        testCoroutineTimer.start()
        advanceTimeBy(<span style="color:#ae81ff">2100</span>)
        assertEquals(<span style="color:#66d9ef">true</span>, testCoroutineTimer.isRunning())
        verify(atLeast = <span style="color:#ae81ff">1</span>, atMost = <span style="color:#ae81ff">1</span>) { mockTimerAction.invoke() }
        advanceTimeBy(<span style="color:#ae81ff">2100</span>)
        testCoroutineTimer.stop()
        verify(atLeast = <span style="color:#ae81ff">2</span>, atMost = <span style="color:#ae81ff">2</span>) { mockTimerAction.invoke() }

        assertEquals(<span style="color:#66d9ef">false</span>, testCoroutineTimer.isRunning())
    }
</code></pre></div><h2 id="unit-testing-the-implementation-with-kotest">Unit testing the implementation with Kotest</h2>
<p><a href="https://kotest.io/">Kotest</a> is a more modern testing framework for Kotlin. It makes heavy use of coroutines for its implementation, and therefore includes first-class support for them. For example, you can unit test <code>suspend</code> functions without enclosing them in <code>runBlocking</code> or <code>runBlockingTest</code> calls. In the upcoming 5.0.0 release there will be support for the <a href="https://github.com/kotest/kotest/pull/2550">TestCoroutinDispatcher</a>, which is currently available in the 5.0.0.M3 snapshot release.</p>
<p>The changes required for the conversion of the tests to the Kotest library, can be found <a href="https://github.com/gmetal/coroutine-timer/commit/d5b5bc74528039df8c08c0b6f35acd3fa282dc31">here</a>. One of the great advantages of Kotest is that it supports using multiple testing styles. The unit tests of the CoroutineTimer were converted to the BehaviorSpec testing style. The <code>TestCoroutineDispatcher</code> in Kotest is exported through the [DelayController interface]{https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-test/kotlinx.coroutines.test/-delay-controller/index.html}. We can enable it (along with a default timeout of all test cases) in our Kotest BehaviorSpec tests, with the following code:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin" data-lang="kotlin"><span style="color:#a6e22e">@ExperimentalStdlibApi</span>
<span style="color:#a6e22e">@ExperimentalKotest</span>
<span style="color:#a6e22e">@ExperimentalCoroutinesApi</span>
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">CoroutineTimerTest</span> : BehaviorSpec({
    <span style="color:#75715e">// Sets per-test case timeout for all test cases in the spec
</span><span style="color:#75715e"></span>    timeout = <span style="color:#ae81ff">3500</span>
    <span style="color:#75715e">// Enable the TestCoroutineDispatcher
</span><span style="color:#75715e"></span>    testCoroutineDispatcher = <span style="color:#66d9ef">true</span>
</code></pre></div><p>To get access to the coroutine dispatcher in use you can use the following code:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin" data-lang="kotlin">coroutineContext[CoroutineDispatcher.Key]
</code></pre></div><p>Kotest uses the TestCoroutineDispatcher in the current <code>coroutineContext</code>, which can be acquired through the <code>CoroutineDispatcher.Key</code>. Thus we can create an initialisation function like the following:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin" data-lang="kotlin">    <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">setupTest</span>(repeat: Boolean, coroutineContext: CoroutineContext) {
        mockTimerAction = mockk()
        every { mockTimerAction.invoke() } just Runs

        testCoroutineTimer = CoroutineTimer(
            <span style="color:#ae81ff">2000</span>,
            repeat,
            timerAction = mockTimerAction,
            dispatcher = coroutineContext[CoroutineDispatcher.Key]<span style="color:#f92672">!!</span>
        )
    }
</code></pre></div><p>In our tests we need not use the <code>runBlockingTest</code> function call like before. In order to adjust the internal coroutine dispatcher timer, Kotest exposes the <code>delayController</code> property of the TestContext. Apart from the different testing style introduced, very little needs to be changed, in comparison with the JUnit approach and the <a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-test/">kotlinx-coroutines-test artifact</a>. Thus the tests can be rewritten:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin" data-lang="kotlin">Given(<span style="color:#e6db74">&#34;a CoroutineTimer&#34;</span>) {
    And(<span style="color:#e6db74">&#34;the timer executes once&#34;</span>) {
        And(<span style="color:#e6db74">&#34;the timer is running&#34;</span>) {
            When(<span style="color:#e6db74">&#34;the timer is executed&#34;</span>) {
                setupTest(repeat = <span style="color:#66d9ef">false</span>, testContext.coroutineContext)
                 testCoroutineTimer.start()
                <span style="color:#66d9ef">val</span> timerWasRunning = testCoroutineTimer.isRunning()

                delayController.advanceTimeBy(<span style="color:#ae81ff">2100</span>)

                Then(<span style="color:#e6db74">&#34;the timer was running&#34;</span>) {
                    timerWasRunning shouldBe <span style="color:#66d9ef">true</span>
                }
                Then(<span style="color:#e6db74">&#34;the timer stops running&#34;</span>) {
                    testCoroutineTimer.isRunning() shouldBe <span style="color:#66d9ef">false</span>
                }
                Then(<span style="color:#e6db74">&#34;the timerAction is executed once&#34;</span>) {
                    verify(atMost = <span style="color:#ae81ff">1</span>, atLeast = <span style="color:#ae81ff">1</span>) { mockTimerAction.invoke() }
                }
            }
            When(<span style="color:#e6db74">&#34;the timer is stopped&#34;</span>) {
                setupTest(repeat = <span style="color:#66d9ef">false</span>, testContext.coroutineContext)
                testCoroutineTimer.start()

                delayController.advanceTimeBy(<span style="color:#ae81ff">1000</span>)

                <span style="color:#66d9ef">val</span> timerWasRunning = testCoroutineTimer.isRunning()

                 testCoroutineTimer.stop()
                delayController.advanceTimeBy(<span style="color:#ae81ff">1500</span>)

                Then(<span style="color:#e6db74">&#34;verify the time was running&#34;</span>) {
                    timerWasRunning shouldBe <span style="color:#66d9ef">true</span>
                }
                Then(<span style="color:#e6db74">&#34;the timer stops running&#34;</span>) {
                    assertEquals(<span style="color:#66d9ef">false</span>, testCoroutineTimer.isRunning())
                }
                Then(<span style="color:#e6db74">&#34;the timer actions is not executed&#34;</span>) {
                    verify { mockTimerAction wasNot called }
                }
            }
        }
    }
    And(<span style="color:#e6db74">&#34;the timer executes indefinitely&#34;</span>) {
        When(<span style="color:#e6db74">&#34;a single time period has elapsed&#34;</span>) {
            setupTest(repeat = <span style="color:#66d9ef">true</span>, testContext.coroutineContext)
            testCoroutineTimer.start()
            delayController.advanceTimeBy(<span style="color:#ae81ff">2100</span>)
            <span style="color:#66d9ef">val</span> timerWasRunning = testCoroutineTimer.isRunning()
            delayController.advanceTimeBy(<span style="color:#ae81ff">2100</span>)

            testCoroutineTimer.stop()

            Then(<span style="color:#e6db74">&#34;the timer was running&#34;</span>) {
                timerWasRunning shouldBe <span style="color:#66d9ef">true</span>
            }
            Then(<span style="color:#e6db74">&#34;the timer action has executed twice&#34;</span>) {
                verify(atLeast = <span style="color:#ae81ff">2</span>, atMost = <span style="color:#ae81ff">2</span>) { mockTimerAction.invoke() }
            }
            Then(<span style="color:#e6db74">&#34;the timer is not running&#34;</span>) {
                testCoroutineTimer.isRunning() shouldBe <span style="color:#66d9ef">false</span>
            }
        }
    }}
})
</code></pre></div><h2 id="benchmarking-the-different-test-implementations">Benchmarking the different test implementations</h2>
<p>To benchmark the performance gains of using the <code>kotlinx-coroutine-test</code> means of testing versus the traditional <code>sleep</code> approach versus the Kotest implementation, the tests were executed 10 times with each different approach. The tables below summarises the results, which show that the tests using the coroutine tools were significantly faster.</p>
<table>
<thead>
<tr>
<th>Run iteration</th>
<th>Test w/h Sleeps</th>
<th>Test with Coroutines</th>
<th>Test with Kotest</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>10.878</td>
<td>2.452</td>
<td>0.022</td>
</tr>
<tr>
<td>2</td>
<td>10.813</td>
<td>2.416</td>
<td>0.017</td>
</tr>
<tr>
<td>3</td>
<td>10.916</td>
<td>2.805</td>
<td>0.025</td>
</tr>
<tr>
<td>4</td>
<td>10.865</td>
<td>2.263</td>
<td>0.013</td>
</tr>
<tr>
<td>5</td>
<td>10.890</td>
<td>2.771</td>
<td>0.016</td>
</tr>
<tr>
<td>6</td>
<td>10.948</td>
<td>2.727</td>
<td>0.021</td>
</tr>
<tr>
<td>7</td>
<td>10.894</td>
<td>2.641</td>
<td>0.019</td>
</tr>
<tr>
<td>8</td>
<td>10.906</td>
<td>2.785</td>
<td>0.037</td>
</tr>
<tr>
<td>9</td>
<td>10.905</td>
<td>2.694</td>
<td>0.021</td>
</tr>
<tr>
<td>10</td>
<td>10.912</td>
<td>2.330</td>
<td>0.024</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th></th>
<th>Test w/h Sleeps</th>
<th>Test with Coroutines</th>
<th>Test with Kotest</th>
</tr>
</thead>
<tbody>
<tr>
<td>AVG</td>
<td>10.890</td>
<td>2.617</td>
<td>0.024</td>
</tr>
<tr>
<td>MEDIAN</td>
<td>10.894</td>
<td>2.694</td>
<td>0.021</td>
</tr>
</tbody>
</table>
<p>The tests executed with Kotest were blazingly fast. It is worth pointing out, that on the machine were the tests were run, it took a bit more than 2 seconds to initialise the JUnit coroutine test suite. This time was added in the first test executed. This means, that excluding the test initialisation, the tests using coroutine tools took milliseconds to complete, making them comparable to the Kotest tests. Clearly, using coroutines results in code which is much cleaner, more testable and much faster.</p>

      </div>
    </article>

    <hr />

    <div class="post-info">
      
    <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg>

        <span class="tag"><a href="https://gmetal.dev/tags/unit-test/">unit test</a></span>
        <span class="tag"><a href="https://gmetal.dev/tags/coroutines/">coroutines</a></span>
        <span class="tag"><a href="https://gmetal.dev/tags/kotest/">kotest</a></span>
        <span class="tag"><a href="https://gmetal.dev/tags/junit5/">junit5</a></span>
        <span class="tag"><a href="https://gmetal.dev/tags/timer/">timer</a></span>
        
    </p>

      

      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
          <polyline points="14 2 14 8 20 8"></polyline>
          <line x1="16" y1="13" x2="8" y2="13"></line>
          <line x1="16" y1="17" x2="8" y2="17"></line>
          <polyline points="10 9 9 9 8 9"></polyline>
        </svg>
        2558 Words
      </p>

      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar">
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
          <line x1="16" y1="2" x2="16" y2="6"></line>
          <line x1="8" y1="2" x2="8" y2="6"></line>
          <line x1="3" y1="10" x2="21" y2="10"></line>
        </svg>
        
          2021-11-03 08:01
        

         
          
        
      </p>
    </div>
      <hr />
      <div class="sharing-buttons">
        
<a class="resp-sharing-button__link" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fgmetal.dev%2fposts%2funit-testing-withtimeout-with-kotest%2f" target="_blank" rel="noopener" aria-label="" title="Share on facebook">
  <div class="resp-sharing-button resp-sharing-button--facebook resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"></path></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="https://twitter.com/intent/tweet/?url=https%3a%2f%2fgmetal.dev%2fposts%2funit-testing-withtimeout-with-kotest%2f" target="_blank" rel="noopener" aria-label="" title="Share on twitter">
  <div class="resp-sharing-button resp-sharing-button--twitter resp-sharing-button--small">
      <div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="https://www.tumblr.com/widgets/share/tool?posttype=link&amp;title=Unit%20Testing%20WithTimeout%20in%20Coroutines%20With%20Kotest&amp;caption=Unit%20Testing%20WithTimeout%20in%20Coroutines%20With%20Kotest&amp;canonicalUrl=https%3a%2f%2fgmetal.dev%2fposts%2funit-testing-withtimeout-with-kotest%2f" target="_blank" rel="noopener" aria-label="" title="Share on tumblr">
  <div class="resp-sharing-button resp-sharing-button--tumblr resp-sharing-button--small">
    <div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.563 24c-5.093 0-7.031-3.756-7.031-6.411V9.747H5.116V6.648c3.63-1.313 4.512-4.596 4.71-6.469C9.84.051 9.941 0 9.999 0h3.517v6.114h4.801v3.633h-4.82v7.47c.016 1.001.375 2.371 2.207 2.371h.09c.631-.02 1.486-.205 1.936-.419l1.156 3.425c-.436.636-2.4 1.374-4.156 1.404h-.178l.011.002z"/></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="mailto:?subject=Unit%20Testing%20WithTimeout%20in%20Coroutines%20With%20Kotest&amp;body=https%3a%2f%2fgmetal.dev%2fposts%2funit-testing-withtimeout-with-kotest%2f" target="_self" rel="noopener" aria-label="" title="Share via email">
  <div class="resp-sharing-button resp-sharing-button--email resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="https://pinterest.com/pin/create/button/?url=https%3a%2f%2fgmetal.dev%2fposts%2funit-testing-withtimeout-with-kotest%2f&amp;media=https%3a%2f%2fgmetal.dev%2fposts%2funit-testing-withtimeout-with-kotest%2f;description=Unit%20Testing%20WithTimeout%20in%20Coroutines%20With%20Kotest" target="_blank" rel="noopener" aria-label="" title="Share on pinterest">
  <div class="resp-sharing-button resp-sharing-button--pinterest resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M12.017 0C5.396 0 .029 5.367.029 11.987c0 5.079 3.158 9.417 7.618 11.162-.105-.949-.199-2.403.041-3.439.219-.937 1.406-5.957 1.406-5.957s-.359-.72-.359-1.781c0-1.663.967-2.911 2.168-2.911 1.024 0 1.518.769 1.518 1.688 0 1.029-.653 2.567-.992 3.992-.285 1.193.6 2.165 1.775 2.165 2.128 0 3.768-2.245 3.768-5.487 0-2.861-2.063-4.869-5.008-4.869-3.41 0-5.409 2.562-5.409 5.199 0 1.033.394 2.143.889 2.741.099.12.112.225.085.345-.09.375-.293 1.199-.334 1.363-.053.225-.172.271-.401.165-1.495-.69-2.433-2.878-2.433-4.646 0-3.776 2.748-7.252 7.92-7.252 4.158 0 7.392 2.967 7.392 6.923 0 4.135-2.607 7.462-6.233 7.462-1.214 0-2.354-.629-2.758-1.379l-.749 2.848c-.269 1.045-1.004 2.352-1.498 3.146 1.123.345 2.306.535 3.55.535 6.607 0 11.985-5.365 11.985-11.987C23.97 5.39 18.592.026 11.985.026L12.017 0z"/></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fgmetal.dev%2fposts%2funit-testing-withtimeout-with-kotest%2f&amp;title=Unit%20Testing%20WithTimeout%20in%20Coroutines%20With%20Kotest&amp;summary=Unit%20Testing%20WithTimeout%20in%20Coroutines%20With%20Kotest&amp;source=https%3a%2f%2fgmetal.dev%2fposts%2funit-testing-withtimeout-with-kotest%2f" target="_blank" rel="noopener" aria-label="" title="Share on linkedin">
  <div class="resp-sharing-button resp-sharing-button--linkedin resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect x="2" y="9" width="4" height="12"></rect><circle cx="4" cy="4" r="2"></circle></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="https://reddit.com/submit/?url=https%3a%2f%2fgmetal.dev%2fposts%2funit-testing-withtimeout-with-kotest%2f&amp;resubmit=true&amp;title=Unit%20Testing%20WithTimeout%20in%20Coroutines%20With%20Kotest" target="_blank" rel="noopener" aria-label="" title="Share on reddit">
  <div class="resp-sharing-button resp-sharing-button--reddit resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M12 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0zm5.01 4.744c.688 0 1.25.561 1.25 1.249a1.25 1.25 0 0 1-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968 0 1.754.786 1.754 1.754 0 .716-.435 1.333-1.01 1.614a3.111 3.111 0 0 1 .042.52c0 2.694-3.13 4.87-7.004 4.87-3.874 0-7.004-2.176-7.004-4.87 0-.183.015-.366.043-.534A1.748 1.748 0 0 1 4.028 12c0-.968.786-1.754 1.754-1.754.463 0 .898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342 0 0 1 .14-.197.35.35 0 0 1 .238-.042l2.906.617a1.214 1.214 0 0 1 1.108-.701zM9.25 12C8.561 12 8 12.562 8 13.25c0 .687.561 1.248 1.25 1.248.687 0 1.248-.561 1.248-1.249 0-.688-.561-1.249-1.249-1.249zm5.5 0c-.687 0-1.248.561-1.248 1.25 0 .687.561 1.248 1.249 1.248.688 0 1.249-.561 1.249-1.249 0-.687-.562-1.249-1.25-1.249zm-5.466 3.99a.327.327 0 0 0-.231.094.33.33 0 0 0 0 .463c.842.842 2.484.913 2.961.913.477 0 2.105-.056 2.961-.913a.361.361 0 0 0 .029-.463.33.33 0 0 0-.464 0c-.547.533-1.684.73-2.512.73-.828 0-1.979-.196-2.512-.73a.326.326 0 0 0-.232-.095z"/></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="https://www.xing.com/app/user?op=share;url=https%3a%2f%2fgmetal.dev%2fposts%2funit-testing-withtimeout-with-kotest%2f;title=Unit%20Testing%20WithTimeout%20in%20Coroutines%20With%20Kotest" target="_blank" rel="noopener" aria-label="" title="Share on xing">
  <div class="resp-sharing-button resp-sharing-button--xing resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M18.188 0c-.517 0-.741.325-.927.66 0 0-7.455 13.224-7.702 13.657.015.024 4.919 9.023 4.919 9.023.17.308.436.66.967.66h3.454c.211 0 .375-.078.463-.22.089-.151.089-.346-.009-.536l-4.879-8.916c-.004-.006-.004-.016 0-.022L22.139.756c.095-.191.097-.387.006-.535C22.056.078 21.894 0 21.686 0h-3.498zM3.648 4.74c-.211 0-.385.074-.473.216-.09.149-.078.339.02.531l2.34 4.05c.004.01.004.016 0 .021L1.86 16.051c-.099.188-.093.381 0 .529.085.142.239.234.45.234h3.461c.518 0 .766-.348.945-.667l3.734-6.609-2.378-4.155c-.172-.315-.434-.659-.962-.659H3.648v.016z"/></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="whatsapp://send?text=Unit%20Testing%20WithTimeout%20in%20Coroutines%20With%20Kotest%20https%3a%2f%2fgmetal.dev%2fposts%2funit-testing-withtimeout-with-kotest%2f" target="_blank" rel="noopener" aria-label="" title="Share on whatsapp">
  <div class="resp-sharing-button resp-sharing-button--whatsapp resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fgmetal.dev%2fposts%2funit-testing-withtimeout-with-kotest%2f&amp;t=Unit%20Testing%20WithTimeout%20in%20Coroutines%20With%20Kotest" target="_blank" rel="noopener" aria-label="" title="Share on hacker news">
  <div class="resp-sharing-button resp-sharing-button--hackernews resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
			<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M0 24V0h24v24H0zM6.951 5.896l4.112 7.708v5.064h1.583v-4.972l4.148-7.799h-1.749l-2.457 4.875c-.372.745-.688 1.434-.688 1.434s-.297-.708-.651-1.434L8.831 5.896h-1.88z"/></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="https://telegram.me/share/url?text=Unit%20Testing%20WithTimeout%20in%20Coroutines%20With%20Kotest&amp;url=https%3a%2f%2fgmetal.dev%2fposts%2funit-testing-withtimeout-with-kotest%2f" target="_blank" rel="noopener" aria-label="" title="Share on telegram">
  <div class="resp-sharing-button resp-sharing-button--telegram resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
    </div>
  </div>
</a>

      </div>

    
    <div class="pagination">
        <div class="pagination__title">
            <span class="pagination__title-h">Read other posts</span>
            <hr />
        </div>

        <div class="pagination__buttons">
            

            
            <span class="button next">
                <a href="https://gmetal.dev/posts/using-kotest/">
                    <span class="button__text">Using kotest in your Android project</span>
                    <span class="button__icon">â†’</span>
                </a>
            </span>
            
        </div>
    </div>


    

    

  </main>

            </div>

            
                <footer class="footer">
    
    <div class="footer__inner">
        <div class="footer__content">
            <span>&copy; 2021</span>
            <span><a href="https://gmetal.dev/">George Metaxas</a></span>
            <span><a href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank" rel="noopener">CC BY-NC 4.0</a></span>
            <span><a href="https://gmetal.dev/posts/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></span>
            
        </div>
    </div>
    
    
    <div class="footer__inner">
        <div class="footer__content">
            <span>Powered by <a href="http://gohugo.io">Hugo</a></span><span>Made with &#10084; with <a href="https://github.com/rhazdon/hugo-theme-hello-friend-ng/">Hello Friend NG</a></span>
        </div>
    </div>
    
</footer>

            
        </div>

        



<script type="text/javascript" src="/bundle.min.599099f1f14b78b657d524b28e10e0c5098e7cd46e9c7aed73d577068a276c3ff1bb234cbf29cb313333e83cf411727b43157c91ce5b809e2ffc81664614608e.js" integrity="sha512-WZCZ8fFLeLZX1SSyjhDgxQmOfNRunHrtc9V3BoonbD/xuyNMvynLMTMz6Dz0EXJ7QxV8kc5bgJ4v/IFmRhRgjg=="></script>



    </body>
</html>
